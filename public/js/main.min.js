define("plugbot/controllers/module",["angular"],function(t){return t.module("app.controllers",[])}),define("plugbot/controllers/MainCtrl",["plugbot/controllers/module"],function(t){t.controller("MainCtrl",["$scope","Settings","SiteApi",function(t,e,n){function i(t){var n=!l[t.id];_.isFunction(t.switchEnabled)&&t.switchEnabled(n),l[t.id]=n,e.save()}function o(t){t.switchEnabled(l[t.id])}function a(e){t.mediaUrl=e&&e.url?e.url:null}var r="MainCtrl.mediaLink",l=e.read().main;t.items=[{id:"autoWoot",text:"Woottaa kappaletta automaattisesti",init:o,handlerClick:i,switchEnabled:function(t){n.autoWoot(t)}},{id:"autoJoin",text:"Liity odotuslistalle automaattisesti",init:o,handlerClick:i,switchEnabled:function(t){n.autoJoin(t)}}],t.isExpanded=!1,t.mediaUrl=null,t.handleButtonClick=function(){return"toggle"},t.isEnabled=function(t){return l[t.id]},t.click=function(t){_.isFunction(t.handlerClick)&&t.handlerClick(t)},t.getMediaLink=function(){n.getMedia(a)},_.each(t.items,function(t){_.isFunction(t.init)&&t.init(t)}),n.getMedia(a),n.bindMediaChange(r,function(){t.mediaUrl=null},a),t.$on("$destroy",function(){n.autoWoot(!1),n.autoJoin(!1),n.unbindMediaChange(r)})}])}),define("plugbot/controllers/SettingsCtrl",["plugbot/controllers/module"],function(t){t.controller("SettingsCtrl",["$scope","$window","Settings",function(t,e,n){t.items=[{text:"Palauta oletusasetukset",click:function(){e.confirm("Oletko varma?\nPalauttaaksesi Plug.dj-palvelun oletusasetukset sinun täytyy päivittää sivu.")&&n.reset()}}],t.handleButtonClick=function(){return"hide"}}])}),define("plugbot/controllers/index",["plugbot/controllers/MainCtrl","plugbot/controllers/SettingsCtrl"],_.noop),define("plugbot/directives/module",["angular"],function(t){return t.module("app.directives",[])}),define("plugbot/directives/draggable",["plugbot/directives/module","angular"],function(t,e){t.directive("draggable",["$document","$window","DomGeometry","Settings",function(t,n,i,o){return{restrict:"A",scope:{dragGrid:"&"},controller:["$scope",function(t){var e;t.settings=o.read(),e=t.settings.window,t.loadPosition=function(t,n,i){t&&e[t]&&n(e[t])&&i(e[t])},t.savePosition=function(t,n){t&&n&&(e[t]=n,o.save())}}],link:function(o,a,r){function l(){var t,e=M.iframe;e.length&&(t=e.css("pointer-events"),e.css("pointer-events","none"),E.originalPointerEvents=t)}function d(){var t=M.iframe;t.length&&t.css("pointer-events",E.originalPointerEvents)}function s(){M.relative&&a.css({position:"absolute",left:a.prop("offsetLeft"),top:a.prop("offsetTop"),width:a.outerWidth(),height:a.outerHeight()})}function c(){M.relative&&a.css({position:"relative",left:"",top:"",width:"",height:""})}function u(t){a.css("z-index",t)}function g(t,e){var n=e.outerWidth(),i=e.outerHeight();return{left:t.x,top:t.y,right:t.x+n,bottom:t.y+i,width:n,height:i}}function p(t){var e,n,o,r=M.containment,l={x:t.x,y:t.y};return M.grid&&(l.x-=l.x%M.grid[0],l.y-=l.y%M.grid[1]),_.each(M.snap,function(t){var e=i.getSnap(t,g(l,a),M.snapMode,M.snapTolerance);(e.x||e.y)&&(l.x+=e.x,l.y+=e.y)}),r.length&&(e=g(l,a),n=i.isContain(r,e),n.x&&n.y||(o=i.getRestraint(r,e),n.x||(l.x=o.left),n.y||(l.y=o.top))),l}function f(t){var e=!0,n=g(t,a),o=M.containment;return o.length&&(e=i.isContain(o,n)),e&&_.each(M.elemNoOverlap,function(t){e&&(e=!i.isIntersect(t,n))}),e}function h(t){E.currentPosition=t,a.css({left:t.x,top:t.y})}function m(t){var e=p(t);f(e)&&h(e)}function v(){o.$apply(function(){var t,e,n,i=M.elemKeepZoom;i.length&&(t={width:i.width(),height:i.height()},e={width:t.width/E.originalKeepZoomSize.width,height:t.height/E.originalKeepZoomSize.height},n={x:E.currentPosition.x*e.width,y:E.currentPosition.y*e.height},n=p(n),f(n)&&h(n),E.originalKeepZoomSize=t)})}function b(){o.$apply(function(){var t=E.currentMouseOffset,e={x:R.scrollLeft()-k.x,y:R.scrollTop()-k.y},n={x:C.x+t.x+e.x,y:C.y+t.y+e.y};E.currentScrollOffset=e,m(n)})}function w(t){var e=E.currentScrollOffset,n={x:t.clientX-S.x,y:t.clientY-S.y},i={x:C.x+n.x+e.x,y:C.y+n.y+e.y};return E.currentMouseOffset=n,m(i),!1}function x(){return o.savePosition(M.id,E.currentPosition),c(),u(I),d(),R.off("scroll",b),t.off("mousemove",w),t.off("mouseup",x),!1}function y(n){var i,o=e.element(n.target);return o.closest(r.dragCancel).length||(C={x:a.prop("offsetLeft"),y:a.prop("offsetTop")},S={x:n.clientX,y:n.clientY},k={x:R.scrollLeft(),y:R.scrollTop()},_.extend(M,{containment:e.element(r.dragContainment),iframe:e.element(r.dragIframeFix),snap:e.element(r.dragSnap),elemNoOverlap:e.element(r.dragNoOverlap),elemKeepZoom:e.element(r.dragKeepZoom)}),_.extend(E,{currentMouseOffset:{x:0,y:0},currentScrollOffset:{x:0,y:0},currentPosition:void 0,originalPointerEvents:void 0}),s(),u(M.zIndex),l(),R.on("scroll",b),t.on("mousemove",w),t.on("mouseup",x),i=!1),i}var C,S,k,M,E,R=e.element(n),I=a.css("z-index"),A=a.find(r.dragHandle);M={id:r.dragId,relative:""===r.dragRelative,zIndex:r.dragZIndex,containment:e.element(r.dragContainment),containmentTolerance:r.dragContainmentTolerance,iframe:e.element(r.dragIframeFix),grid:o.dragGrid(),snap:e.element(r.dragSnap),snapMode:r.dragSnapMode,snapTolerance:r.dragSnapTolerance||8,elemNoOverlap:e.element(r.dragNoOverlap),elemKeepZoom:e.element(r.dragKeepZoom)},E={currentPosition:{x:a.prop("offsetLeft"),y:a.prop("offsetTop")},originalKeepZoomSize:{width:M.elemKeepZoom.width(),height:M.elemKeepZoom.height()}},A.length||(A=a),c(),o.loadPosition(M.id,f,h),R.on("resize",v),A.on("mousedown",y),a.on("$destroy",function(){R.off("resize",v),A.off("mousedown",y)})}}}])}),define("plugbot/directives/href",["plugbot/directives/module"],function(t){t.directive("href",function(){return{restrict:"A",link:function(t,e,n){function i(){var n=t[o];n?(e.attr("target","_blank"),e.attr("href",n)):_.isFunction(t.getMediaLink)&&t.getMediaLink()}var o=n.href;e.on("click",i),e.on("mouseenter",i),e.on("$destroy",function(){e.off("click",i),e.off("mouseenter",i)})}}})}),define("plugbot/directives/window",["plugbot/directives/module","angular"],function(t,e){t.directive("window",function(){return{restrict:"A",link:function(t,n,i){function o(t,n){var i=e.element(t.data("window-toggle"));i.length&&i[n]()}function a(n){t.$apply(function(){var i,a=e.element(n.target),r=a.data("window-id");r&&t.handleButtonClick&&(i=t.handleButtonClick(r),o(a,i))})}var r,l=n.find(".handle-buttons");i.window&&n[i.window](),l.length&&(r=l.children(),r.length&&r.on("click",a)),n.on("$destroy",function(){r.off("click",a)})}}})}),define("plugbot/directives/index",["plugbot/directives/draggable","plugbot/directives/href","plugbot/directives/window"],_.noop),define("plugbot/services/module",["angular"],function(t){return t.module("app.services",[])}),define("plugbot/services/utils/DomGeometry",["plugbot/services/module","angular"],function(t,e){t.factory("DomGeometry",["$window",function(t){return{isContainRect:function(t,e){var n={x:!1,y:!1};return t.left-e.left<=0&&e.right-t.right<=0&&(n.x=!0),t.top-e.top<=0&&e.bottom-t.bottom<=0&&(n.y=!0),n},isIntersectRect:function(t,e){return t.left-e.right<0&&e.left-t.right<0&&t.top-e.bottom<0&&e.top-t.bottom<0},isContain:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e);return this.isContainRect(n,i)},isIntersect:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e);return this.isIntersectRect(n,i)},getSnap:function(t,e,n,i){var o,a,r=this.getBoundingRect(t),l=this.getBoundingRect(e),d=["left","right"],s=["top","bottom"],c=[],u={x:0,y:0};for(("inner"===n||"both"===n)&&c.push([0,0],[1,1]),("outer"===n||"both"===n)&&c.push([0,1],[1,0]),o=0;o<c.length;o+=1)a=r[d[c[o][0]]]-l[d[c[o][1]]],Math.abs(a)<=i&&r.top<=l.bottom&&l.top<=r.bottom&&(u.x+=a),a=r[s[c[o][0]]]-l[s[c[o][1]]],Math.abs(a)<=i&&r.left<=l.right&&l.left<=r.right&&(u.y+=a);return u},getRestraint:function(t,e){var n=this.getBoundingRect(t),i=this.getBoundingRect(e),o=this.isContainRect(n,i),a=i;return o.x||(i.left<n.left?(a.left=n.left,a.right=n.left+i.width):(a.right=n.right,a.left=n.right-i.width)),o.y||(i.top<n.top?(a.top=n.top,a.bottom=n.top+i.height):(a.bottom=n.bottom,a.top=n.bottom-i.height)),a},offsetRect:function(t,e){e=_.clone(e),_.defaults(e,{x:0,y:0}),t.left+=e.x,t.right+=e.x,t.top+=e.y,t.bottom+=e.y},getBoundingRect:function(n){var i,o=e.element(t),a=["left","right","top","bottom","width","height"],r={x:o.scrollLeft(),y:o.scrollTop()};return n instanceof e.element?(i=_.pick(n[0].getBoundingClientRect(),a),this.offsetRect(i,r)):n instanceof HTMLElement?(i=_.pick(n.getBoundingClientRect(),a),this.offsetRect(i,r)):i=n,i}}}])}),define("plugbot/services/Export",["plugbot/services/module","angular"],function(t,e){t.factory("Export",["$window","Settings",function(t,n){t.plugbot={version:"2.0.5",dev:{getSiteHighestZIndex:function(){var t=e.element("#audience, #dj-booth, #playback-container, #dj-button, #vote, .app-right"),n={element:null,zIndex:-1};return _.each(t,function(t){var i=e.element(t).css("z-index");i>n.zIndex&&(n={element:t,zIndex:i})}),n}},resetSettings:function(){n.reset()}}}])}),define("plugbot/services/DomInjection",["plugbot/services/module","angular"],function(t,e){t.factory("DomInjection",["$templateCache",function(t){var n=e.element("#app");n.append(t.get("main.tpl.html")),n.append(t.get("settings.tpl.html"))}])}),define("plugbot/services/Settings",["plugbot/services/module"],function(t){t.factory("Settings",["$window",function(t){var e,n="plugbotEnhanced",i=t.localStorage,o={main:{autoWoot:!0,autoJoin:!1},window:{main:{x:70,y:85},settings:{x:80,y:100}}};return{read:function(){var t;return e?t=e:(t=i[n]?JSON.parse(i[n]):this._clone(),e=t),t},save:function(){this._debounceSave()},reset:function(){delete i[n]},_debounceSave:_.debounce(function(){i[n]=JSON.stringify(e)},1e3),_clone:function(){return JSON.parse(JSON.stringify(o))}}}])}),define("plugbot/services/SiteApi",["plugbot/services/module","angular"],function(t,e){t.factory("SiteApi",["$http","$interval","$window",function(t,n,i){var o,a,r,l=i.API;return{woot:function(){var t=this;this.stopWoot(),o=n(function(){var n=e.element("#woot"),i=l.getUser(),o=l.getDJ();o&&o.id!==i.id&&0===i.vote?n.click():t.stopWoot()},1e3)},join:function(){var t=this;this.stopJoin(),a=n(function(){var e=l.djJoin();e||t.stopJoin()},1e3)},getMedia:function(e,n){var i;n||(n=l.getMedia()),n&&(i={},1===n.format?(i.format="youtube",i.url="//www.youtube.com/watch?v="+n.cid,e(i)):(i.format="soundcloud",t.get("//api.soundcloud.com/tracks/"+n.cid+".json?client_id=YOUR_CLIENT_ID").then(function(t){i.url=t.data.permalink_url},function(){i.url=null}).then(function(){e(i)})))},stopWoot:function(){n.cancel(o)},stopJoin:function(){n.cancel(a)},autoWoot:function(t){t?(l.on(l.ADVANCE,this.woot,this),this.woot()):(l.off(l.ADVANCE,this.woot),this.stopWoot())},autoJoin:function(t){t?(l.on(l.WAIT_LIST_UPDATE,this.join,this),this.join()):(l.off(l.WAIT_LIST_UPDATE,this.join),this.stopJoin())},onMediaChange:function(t){var e=this;_.each(r,function(n){n.onAdvance(),e.getMedia(n.onResolved,t.media)})},bindMediaChange:function(t,e,n){r||(l.on(l.ADVANCE,this.onMediaChange,this),r={}),r[t]={onAdvance:e,onResolved:n}},unbindMediaChange:function(t){t?delete r[t]:(l.off(l.ADVANCE,this.onMediaChange),r={})},destroy:function(){this.autoWoot(!1),this.autoJoin(!1),this.unbindMediaChange()}}}])}),define("plugbot/services/index",["plugbot/services/utils/DomGeometry","plugbot/services/Export","plugbot/services/DomInjection","plugbot/services/Settings","plugbot/services/SiteApi"],_.noop),angular.module("app.views",["main.tpl.html","settings.tpl.html"]),angular.module("main.tpl.html",[]).run(["$templateCache",function(t){t.put("main.tpl.html",'<div class="plugbot-window plugbot-main"\n     data-window\n     data-draggable\n     data-drag-id="main"\n     data-drag-z-index="1000000"\n     data-drag-containment="#app"\n     data-drag-iframe-fix="#yt-frame"\n     data-drag-handle=".handle"\n     data-drag-cancel=".handle-buttons"\n     data-drag-grid="[4, 4]"\n     data-drag-snap=".app-header, #audience, #dj-booth, #playback-container, #dj-button, #vote, .app-right, #footer"\n     data-drag-snap-mode="outer"\n     data-drag-snap-tolerance="8"\n     data-drag-no-overlap=".app-header, #footer"\n     data-drag-keep-zoom="#app"\n     data-ng-controller="MainCtrl">\n    <div class="handle">\n        <span class="title">Plugbot</span>\n        <span class="handle-buttons">\n            <i class="icon icon-settings-white" data-window-id="settings" data-window-toggle=".plugbot-settings"></i>\n            <i class="icon"\n               data-ng-class="{ \'icon-arrow-up\': isExpanded, \'icon-arrow-down\': !isExpanded }"\n               data-ng-click="isExpanded = !isExpanded"></i>\n        </span>\n    </div>\n    <div class="body">\n        <ul>\n            <li class="item"\n                data-ng-repeat="item in items"\n                data-ng-class="{ \'enabled\': isEnabled(item), disabled: !isEnabled(item) }"\n                data-ng-click="click(item)">{{item.text}}</li>\n            <li><a class="item item-url" data-href="mediaUrl" data-ng-show="isExpanded">Lähetä palautetta PlugWootista</a></li>\n        </ul>\n    </div>\n</div>\n')}]),angular.module("settings.tpl.html",[]).run(["$templateCache",function(t){t.put("settings.tpl.html",'<div class="plugbot-window plugbot-settings"\n     data-window="hide"\n     data-draggable\n     data-drag-id="settings"\n     data-drag-z-index="1000000"\n     data-drag-containment="#app"\n     data-drag-iframe-fix="#yt-frame"\n     data-drag-handle=".handle"\n     data-drag-cancel=".handle-buttons"\n     data-drag-grid="[8, 8]"\n     data-drag-snap="#app"\n     data-drag-snap-mode="inner"\n     data-drag-snap-tolerance="16"\n     data-drag-no-overlap=".app-header, #footer"\n     data-drag-keep-zoom="#app"\n     data-ng-controller="SettingsCtrl">\n    <div class="handle">\n        <span class="title">Settings</span>\n        <span class="handle-buttons">\n            <i class="icon icon-dialog-close" data-window-id="settings" data-window-toggle=".plugbot-settings"></i>\n        </span>\n    </div>\n    <div class="body">\n        <ul>\n            <li class="item"\n                data-ng-repeat="item in items"\n                data-ng-click="item.click()">{{item.text}}</li>\n        </ul>\n    </div>\n</div>\n')}]),define("plugbot/views/index",function(){}),define("plugbot/app",["angular","plugbot/controllers/index","plugbot/directives/index","plugbot/services/index","plugbot/views/index"],function(t){var e=t.module("app",["app.controllers","app.directives","app.services","app.views"]);return e.run(["DomInjection","Export",_.noop]),e}),require(["angular"],function(t){require(["domReady!","plugbot/app"],function(){t.bootstrap(t.element("#app"),["app"])})}),define("main",function(){});